# stc89c52rc-multifunctional-clock
A multifunctional clock system based on STC89C52RC microcontroller with LCD1602 display, DS1302 RTC, DHT11 sensor, and various features including alarm, stopwatch, and countdown timer.
# STC89C52RC 多功能电子时钟系统

![MCU](https://img.shields. io/badge/MCU-STC89C52RC-orange)
![License](https://img.shields.io/badge/license-MIT-green)
![Language](https://img.shields.io/badge/language-C-blue)

## 📖 项目简介

本项目基于 **STC89C52RC 单片机**开发，集成了时钟显示、闹钟、温湿度检测、秒表、倒计时等多种功能，是一个用于学习和实践单片机应用开发的综合项目。前端显示采用 **LCD1602 液晶屏**，支持多按键交互和蜂鸣器提醒。

## ✨ 功能特性

| 功能 | 说明 | 驱动芯片/引脚 |
|-----|------|----------|
| **⏰ 实时时钟** | 显示年月日时分秒，支持手动设置 | DS1302 (P1^0-P1^2) |
| **🔔 闹钟** | 可设置闹钟时间、启用/禁用、蜂鸣提醒 | 软件实现 |
| **🌡️ 温湿度监测** | 实时显示温度和湿度数据 | DHT11 (P1^6) |
| **⏱️ 秒表** | 精准计时，显示分钟和秒数 | Timer0 |
| **⏲️ 倒计时** | 自定义倒计时，时长可调整 | Timer0 |
| **🔊 声音提示** | 闹钟和倒计时结束蜂鸣 | 蜂鸣器 (P2^3) |
| **💾 数据存储** | 支持参数保存 | EEPROM (I2C: P2^0-P2^1) |

## 🛠️ 硬件需求

### 核心芯片
- **主控**：STC89C52RC（8051 兼容）
- **显示**：LCD1602（16×2 字符屏）
- **实时时钟**：DS1302 模块
- **温湿度传感器**：DHT11
- **存储**：EEPROM（24C02 或兼容）
- **按键**：4 个轻触开关
- **蜂鸣器**：无源或有源蜂鸣器

### 引脚连接表

| 器件 | 引脚 | 功能 |
|-----|-----|------|
| **LCD1602** | P0 | 数据总线 (D0-D7) |
| | P2^2 (RS) | 寄存器选择 |
| | P2^5 (RW) | 读/写控制 |
| | P2^6 (EN) | 使能信号 |
| **DS1302** | P1^0 | CLK (时钟) |
| | P1^1 | DAT (数据) |
| | P1^2 | RST (复位) |
| **DHT11** | P1^6 | 单总线数据 |
| **按键** | P3^0 | 模式切换按键 1 |
| | P3^1 | 功能按键 2（选择）|
| | P3^2 | 功能按键 3（加）|
| | P3^3 | 功能按键 4（减）|
| **蜂鸣器** | P2^3 | 声音输出 |
| **EEPROM** | P2^0 (SDA) | I2C 数据线 |
| | P2^1 (SCL) | I2C 时钟线 |

## 📂 项目文件说明

```
├── main.c              # 主程序入口，模式管理和主循环
├── LCD1602.c/h         # LCD1602 液晶屏驱动
├── DS1302.c/h          # DS1302 实时时钟驱动
├── Timer0.c/h          # Timer0 定时器初始化
├── Key.c/h             # 按键扫描驱动
├── Delay.c/h           # 延时函数库
├── beep.c/h            # 蜂鸣器驱动
├── alarm.c/h           # 闹钟功能模块
├── dht11.c/h           # DHT11 温湿度传感器驱动
├── countdown.c/h       # 倒计时功能
├── stopwatch.c/h       # 秒表功能
├── EEPROM.c/h          # I2C EEPROM 驱动
└── README.md           # 项目说明文档
```

### 核心模块功能说明

**main.c** - 主程序
- 模式切换和管理
- 各功能模块的调用
- Timer0 中断处理

**LCD1602.c** - 显示驱动
- `LCD_Init()` - 初始化
- `LCD_ShowString()` - 显示字符串
- `LCD_ShowNum()` - 显示数字

**DS1302.c** - 实时时钟
- `DS1302_Init()` - 初始化
- `DS1302_readtime()` - 读取时间
- `DS1302_settime()` - 设置时间

**alarm.c** - 闹钟模块
- `alarmcheck()` - 检查是否触发
- `alarmRing()` - 处理蜂鸣
- `alarmset()` - 闹钟设置界面

**dht11.c** - 温湿度传感器
- `dht11_Init()` - 初始化
- `dht11_getdata()` - 获取温湿度值

**countdown.c** - 倒计时
- `countdownshow()` - 显示倒计时
- `countdown_timer_handler()` - 倒计时计数

**stopwatch.c** - 秒表
- `stopwatchshow()` - 显示秒表
- `stopwatch_timer_handler()` - 秒表计数

## 🚀 快速开始

### 环境要求
- **编译器**：Keil uVision 5（C51）或 SDCC
- **烧录工具**：STC-ISP v6.88 或更高版本
- **硬件**：STC89C52RC 开发板 + 各模块

### 编译步骤

1. **创建工程**
   ```
   打开 Keil uVision → 新建工程 → 选择芯片：STC89C52RC
   ```

2. **添加源文件**
   ```
   Project → Add Files to Project → 选择所有 . c 和 .h 文件
   ```

3. **配置编译选项**
   ```
   Project → Options for Target
   → C/C++ 标签：优化级别 Level 2
   → Target 标签：晶体振荡器 12. 000 MHz
   ```

4. **编译项目**
   ```
   按 F7 或 Build → Build Target → 生成 .hex 文件
   ```

5. **烧录代码**
   ```
   打开 STC-ISP → 选择 . hex 文件 → 选择 COM 口 → 下载编程
   ```

## 💡 工作原理

### 系统架构

```
┌─────────────────────────────────────────┐
│         STC89C52RC 单片机               │
├─────────────────────────────────────────┤
│  Timer0 中断（每 2ms）                  │
│  ├─ 闪烁控制（flash 变量）             │
│  ├─ DHT11 更新计数器                   │
│  ├─ 秒表计时累加                       │
│  ├─ 倒计时递减                         │
│  └─ 定时任务分发                       │
│                                         │
│  主循环                                 │
│  ├─ 按键扫描                           │
│  ├─ 模式切换与判断                     │
│  ├─ 各功能模块执行                     │
│  └─ LCD 刷新显示                       │
└─────────────────────────────────────────┘
     ↓         ↓         ↓         ↓
 LCD1602    DS1302     DHT11    Beeper
 显示屏     时钟      传感器    蜂鸣器
```

### 系统模式（按键 1 切换）

| 模式 | 功能 | 说明 | 按键操作 |
|-----|------|------|--------|
| **0** | 时间显示 | 显示当前日期时间，监听闹钟 | 按键1进入模式1 |
| **1** | 时间设置 | 设置年月日时分秒 | 按键2选择项，按键3/4增减 |
| **2** | 闹钟设置 | 设置闹钟时间和启用状态 | 按键2选择项，按键3/4增减 |
| **3** | 温湿度 | 实时显示温度和湿度 | 按键1进入下一模式 |
| **4** | 秒表 | 精准计时功能 | 按键2启动/暂停，按键3重置 |
| **5** | 倒计时 | 自定义倒计时 | 按键2启动/暂停，按键3/4增减 |

### 按键功能表

| 按键 | 功能 |
|-----|------|
| **按键 1** | 模式切换 |
| **按键 2** | 选择编辑项 / 启动暂停 |
| **按键 3** | 数值加 1 / 时长加 30s |
| **按键 4** | 数值减 1 / 时长减 30s |

## 🔧 代码亮点

### 1. 非阻塞中断设计
所有实时任务在 Timer0 中断处理，主循环保持快速响应，不会阻塞：

```c
void Timer0_Routine() interrupt 1 {
    // 闪烁控制
    // DHT11 更新计数
    // 秒表/倒计时计数
    // 所有操作均为非阻塞式
}
```

### 2. 模块化代码结构
每个功能独立实现在单独文件中，便于维护、测试、移植：
- alarm.c - 闹钟
- dht11.c - 温湿度
- countdown. c - 倒计时
- stopwatch.c - 秒表

### 3. 灵活的闹钟响铃
采用计数器实现 500ms 鸣 + 500ms 静音循环，无阻塞，任意按键可停止。

### 4. DHT11 单总线通信
正确处理时序，关闭中断避免被打断，数据校验完整性。

## ❓ 常见问题与解决

### Q1: 时钟显示不正常或不走？
- 检查 DS1302 晶体振荡器（32. 768 kHz）是否良好
- 验证 P1^0, P1^1, P1^2 接线是否正确
- 确认 DS1302 供电正常
- 尝试重新设置时间

### Q2: DHT11 无法读取数据？
- 检查 P1^6 接线
- 确认上拉电阻（通常 4. 7 kΩ）已接
- DHT11 初始化需要 18ms 低电平
- 尝试远离干扰源

### Q3: LCD 显示乱码或不显示？
- 检查 P0 数据总线接线（8 条线）
- 验证 P2^2, P2^5, P2^6 控制线
- 调整 LCD 对比度（VL 引脚）
- 检查电源供应（通常需要 5V）

### Q4: 按键无响应？
- 检查 P3^0-P3^3 接线
- 确认按键机械性能良好
- 增加 `Delay(20)` 防抖时间
- 用万用表测试按键电压

### Q5: 蜂鸣器不响或声音弱？
- 检查 P2^3 输出电平
- 确认蜂鸣器极性（有源/无源）
- 增加 `Beep()` 调用时长
- 检查蜂鸣器供电

### Q6: 倒计时或秒表不走？
- 检查 Timer0 是否初始化成功
- 验证中断函数是否执行
- 检查晶体振荡器频率（应为 12 MHz）

## 📚 学习内容

通过本项目可以学到：

- **单片机基础**
  - GPIO 口配置与控制
  - 中断和定时器应用
  - 内存管理与变量作用域

- **硬件驱动**
  - LCD1602 并行接口控制
  - DS1302 三线制协议
  - DHT11 单总线协议
  - I2C EEPROM 通信

- **嵌入式设计**
  - 状态机实现
  - 非阻塞编程范式
  - 模块化代码组织
  - 中断与主循环的协调

- **调试技巧**
  - 硬件故障排查
  - 时序分析
  - 数据校验

## 🔌 硬件接线清单

| 器件 | 接线 |
|-----|-----|
| LCD1602 | P0 (D0-D7), P2^2, P2^5, P2^6, 5V, GND |
| DS1302 | P1^0-2, 5V, GND |
| DHT11 | P1^6, 4.7k上拉, 5V, GND |
| 按键 | P3^0-3, GND |
| 蜂鸣器 | P2^3, GND |
| EEPROM | P2^0-1, 4.7k上拉×2, 5V, GND |

## 📄 许可证

本项目采用 **MIT License** 开源协议，可自由使用、修改和分发。

```
MIT License

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction... 
```

## 👨‍💻 作者

**MoRiv447**

- GitHub: [@MoRiv447](https://github.com/MoRiv447)
- 项目主页：[STC89C52RC-Clock](https://github.com/MoRiv447/STC89C52RC-Clock)

## 💬 反馈与支持

如有问题或建议，欢迎：

- 📝 提交 **Issues** 报告问题
- 💭 发起 **Discussions** 讨论想法
- 🤝 贡献代码 **(Pull Request)**

## 🙏 致谢

感谢以下资源和社区的支持：

- STC 官方单片机文档
- Keil uVision 开发工具
- DHT11 传感器 Datasheet
- DS1302 时钟模块文档
- 开源社区的各类教程和支持

---

**⭐ 如果这个项目对你有帮助，请给个 Star 支持一下！**

最后更新时间：2025-11-29
